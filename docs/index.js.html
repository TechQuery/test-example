<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>index.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="TestFile.html">TestFile</a><ul class='methods'><li data-type='method'><a href="TestFile.html#toString">toString</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-test-example.html">test-example</a></li></ul><h3>Externals</h3><ul><li><a href="external-EventEmitter.html">EventEmitter</a></li></ul><h3>Events</h3><ul><li><a href="TestFile.html#event:itemWrite">itemWrite</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-test-example-test-example.html">test-example</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">

    <h1 class="page-title">index.js</h1>

    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';
/**
 * Test Example - A JSDoc plugin for generating test files by parsing @example
 *
 * @module    {object} test-example
 *
 * @version   0.3.0
 *
 * @see       {@link https://techquery.github.io/test-example|Offical Web site}
 *
 * @copyright TechQuery &lt;shiy007@qq.com> 2017
 */
const Path = require('path'), FS = require('fs-extra');

/**
 * **Config namespace** of this plugin
 *
 * @namespace test-example
 *
 * @example  // Merge those options below to your JSDoc `config.json`
 *     {
 *         "plugins":         ["node_modules/test-example"],
 *         "test-example":    {
 *             "sourcePath":    "path/to/source/directory",
 *             "overWrite":     true,
 *             "headerFile":    "path/to/test/header.js",
 *             "hookModule":    "path/to/plugin/hook"
 *         }
 *     }
 */
const config = require('jsdoc/env').conf['test-example'] || { },
      TestFile = require('./TestFile');

/**
 * Relative directory path of the **Source module**
 *
 * @name sourcePath
 * @type {string}
 *
 * @memberof test-example
 */
const sourcePath = Path.join(process.cwd(),  config.sourcePath || ''),
      testPath = Path.join(process.cwd(), 'test');

/**
 * Path of **Common test code** prepended to every test file
 *
 * @name headerFile
 * @type {string}
 *
 * @memberof test-example
 */
const header = config.headerFile  &amp;&amp;
          FS.existsSync( config.headerFile )  &amp;&amp;
          FS.readFileSync( config.headerFile );

/**
 * Path of the **Hook module**
 *
 * @name hookModule
 * @type {string}
 *
 * @memberof test-example
 */
const hook = config.hookModule &amp;&amp; require(
          Path.join(process.cwd(), config.hookModule)
      );

var file;


exports.handlers = {
    beforeParse:     function (event) {

        file = new TestFile( Path.relative(sourcePath, event.filename) );

        for (var handler in hook)  file.on(handler,  hook[ handler ]);

        if (! /\s*define\(/.test( event.source ))
            file.addHeader(
                `var ${file.ID} = require('${Path.relative(
                    Path.join(testPath, file.URI),
                    Path.join(sourcePath, file.URI)
                )}')`
            );
    },
    newDoclet:       function(event) {

        file.addUnit( event.doclet );
    },
    fileComplete:    function (event) {

        var fileName = Path.join(testPath, file.URI);

        /**
         * Overwrite existed test files or not
         *
         * @name overWrite
         * @type {boolean}
         *
         * @memberof test-example
         */
        if ((! file[0])  ||  (
            FS.existsSync( fileName )  &amp;&amp;  (! config.overWrite)
        ))
            return;

        if ( header )  file.addHeader( header );

        FS.outputFileSync(fileName,  file + '');

        console.log(`\n\t[Test file] ${fileName}\n`);
    }
};
</code></pre>
        </article>
    </section>

</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Nov 24 2017 06:17:40 GMT+0800 (中国标准时间) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
